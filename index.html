<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Simnote - A beautiful journaling app for capturing your thoughts, tracking your moods, and reflecting on your journey." />
    <meta name="theme-color" content="#fcd8ff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Simnote" />
    <title>Simnote</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="img/icon-32.png" />
    <link rel="apple-touch-icon" href="img/icon-192.png" />
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css" />
    <!-- Google Font for cursive logo -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
    <!-- sql.js for SQLite support -->
    <script src="https://sql.js.org/dist/sql-wasm.js"></script>
  </head>
  <body>
    <!-- Manual Button -->
    <button id="manual-btn" class="manual-btn" aria-label="Manual">
      <svg class="menu-icon-svg book-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
      </svg>
    </button>
    <!-- Theme Settings Button -->
    <button id="theme-settings-btn" class="theme-settings-btn" aria-label="Settings">
      <svg class="menu-icon-svg gear-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
      </svg>
    </button>

    <!-- Manual Popup (hidden by default) -->
    <div id="manual-popup" class="manual-popup">
      <h3>Simnote Manual (v0.1.0)</h3>
      <p>
        Welcome to Simnote, a modern journaling application designed for ease of use and aesthetics.
        Current features include:
      </p>
      <ul>
        <li>Create, edit, and save journal entries in a distraction free environment.</li>
        <li>Load and view your saved entries in the journal panel.</li>
        <li>Customize your experience via the settings panel (adjust font size and font family).</li>
        <li>Enjoy beautifully animated backgrounds. We have a few themes to choose from!</li>
      </ul>
      <button id="manual-close-btn" class="button-33" data-emoji="‚ùå">Close</button>
    </div>

    <!-- Theme Settings Popup (hidden by default) -->
    <div id="theme-settings-popup" class="theme-settings-popup">
      <h3>Theme Settings</h3>
      <div class="settings-section">
        <h4 style="margin:0 0 6px 0;">Theme</h4>
        <div class="theme-settings-row">
          <!-- Theme buttons / dropdown -->
          <div class="custom-dropdown" id="theme-dropdown">
            <div class="custom-dropdown-selected" id="theme-selected">Dark Sakura</div>
            <ul class="custom-dropdown-list" id="theme-list">
              <li data-value="dark-sakura">Dark Sakura</li>
              <li data-value="light-sakura">Light Sakura</li>
              <li data-value="plain-dark">Plain Dark</li>
              <li data-value="plain-light">Plain White</li>
              <li data-value="aurora">Aurora</li>
              <li data-value="fireflies">Fireflies</li>
              <li data-value="lavender-breeze">Lavender Breeze</li>
            </ul>
          </div>

          <!-- New preview window -->
          <div id="theme-preview-container" class="theme-preview-container">
            <div id="preview-label" class="preview-label" style="position:absolute;top:-22px;left:0;width:100%;text-align:center;font-size:0.9rem;color:#ccc;"></div>
            <canvas id="theme-preview-canvas" width="220" height="120" style="width:100%;height:100%;border-radius:8px;"></canvas>
          </div>
        </div>
      </div>

      <!-- Storage Settings -->
      <div class="settings-section" style="margin-top:30px;">
        <h4 style="margin:0 0 10px 0;">Storage</h4>
        <div class="storage-info">
          <div class="storage-stat">
            <span class="storage-label">Database</span>
            <span class="storage-value" id="storage-type">SQLite</span>
          </div>
          <div class="storage-stat">
            <span class="storage-label">Entries</span>
            <span class="storage-value" id="storage-entries">0</span>
          </div>
          <div class="storage-stat">
            <span class="storage-label">Size</span>
            <span class="storage-value" id="storage-size">0 KB</span>
          </div>
          <div class="storage-stat">
            <span class="storage-label">Images</span>
            <span class="storage-value" id="storage-images">0</span>
          </div>
        </div>
        <div class="storage-actions">
          <button id="export-data-btn" class="settings-action-btn">Export</button>
          <button id="import-data-btn" class="settings-action-btn">Import</button>
          <button id="clear-data-btn" class="settings-action-btn danger">Clear All</button>
        </div>
        <input type="file" id="import-file-input" accept=".json" style="display:none;" />
      </div>

      <!-- Close button -->
      <button id="theme-settings-close-btn" class="button-33" data-emoji="‚ùå" style="position:absolute;bottom:20px;right:20px;">Close</button>
    </div>

    <!-- Background Canvas -->
    <canvas id="bg-canvas"></canvas>

    <!-- Main Panel -->
    <div id="main-panel">
      <div class="blur-overlay"></div>
      <div class="center-container">
        <div class="logo-and-heart">
          <div class="simnote-logo">
            <span class="logo-text">Simnote</span>
          </div>
        </div>
        <div class="nav-icons">
          <button id="new-entry-btn" class="nav-icon-btn" title="Journal">
            <svg class="nav-icon-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
            <span class="icon-label">Journal</span>
          </button>
          <button id="load-entry-btn" class="nav-icon-btn" title="All Entries">
            <svg class="nav-icon-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M2 3h7a4 4 0 0 1 4 4v14a3 3 0 0 0-4-3H2z"></path>
              <path d="M22 3h-7a4 4 0 0 0-4 4v14a3 3 0 0 1 4-3h7z"></path>
            </svg>
            <span class="icon-label">Entries</span>
          </button>
          <button id="stats-btn" class="nav-icon-btn" title="Mood Tracking">
            <svg class="nav-icon-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
              <line x1="9" y1="9" x2="9.01" y2="9"></line>
              <line x1="15" y1="9" x2="15.01" y2="9"></line>
            </svg>
            <span class="icon-label">Moods</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Journal Panel -->
    <div id="journal-panel" style="display: none;">
      <div class="entries-pane">
        <div class="entries-header">
          <h2 style="margin:0">Entries</h2>
          <!-- Search (magnifying glass) toggle & input -->
          <button id="search-toggle-btn" class="search-toggle-btn" title="Search">üîç</button>
          <input id="entry-search" class="entry-search collapsed" type="text" placeholder="Search..." />
          <!-- Sort dropdown -->
          <div class="custom-dropdown sort-dropdown" id="sort-dropdown">
            <div class="custom-dropdown-selected" id="sort-selected">Newest</div>
            <ul class="custom-dropdown-list" id="sort-list">
              <li data-value="newest">Newest First</li>
              <li data-value="oldest">Oldest First</li>
              <li data-value="az">A ‚Üí Z</li>
              <li data-value="mood">By Mood</li>
            </ul>
          </div>
          <button id="date-picker-btn" class="calendar-btn" title="Filter by date">üìÖ</button>
          <div id="custom-calendar" class="custom-calendar" style="display:none;"></div>
        </div>
        <div class="entry-list"></div>
        <button class="button-33 back-to-menu" role="button" data-emoji="üè†">Back to Menu</button>
      </div>
    </div>

    <!-- Mood Tracking Panel -->
    <div id="stats-panel" class="custom-panel stats-panel" style="display:none;">
      <div class="stats-header">
        <h2>Mood Tracking</h2>
      </div>
      <div class="stats-content">
        <!-- Streak Section -->
        <div class="stats-section streak-section">
          <div class="stat-card streak-card">
            <div class="stat-icon">üî•</div>
            <div class="stat-value" id="current-streak">0</div>
            <div class="stat-label">Day Streak</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-value" id="longest-streak">0</div>
            <div class="stat-label">Best Streak</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìù</div>
            <div class="stat-value" id="total-entries">0</div>
            <div class="stat-label">Total Entries</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìñ</div>
            <div class="stat-value" id="total-words">0</div>
            <div class="stat-label">Words Written</div>
          </div>
        </div>

        <!-- Calendar Heatmap -->
        <div class="stats-section">
          <h3>Activity Calendar</h3>
          <div class="heatmap-container">
            <div class="heatmap-months" id="heatmap-months"></div>
            <div class="heatmap-grid" id="heatmap-grid"></div>
            <div class="heatmap-legend">
              <span>Less</span>
              <div class="legend-cell" data-level="0"></div>
              <div class="legend-cell" data-level="1"></div>
              <div class="legend-cell" data-level="2"></div>
              <div class="legend-cell" data-level="3"></div>
              <div class="legend-cell" data-level="4"></div>
              <span>More</span>
            </div>
          </div>
        </div>

        <!-- Mood Distribution -->
        <div class="stats-section">
          <h3>Mood Distribution</h3>
          <div class="mood-chart" id="mood-chart"></div>
        </div>

        <!-- Writing Stats -->
        <div class="stats-section">
          <h3>Writing Statistics</h3>
          <div class="writing-stats">
            <div class="writing-stat">
              <span class="stat-name">Average words per entry</span>
              <span class="stat-val" id="avg-words">0</span>
            </div>
            <div class="writing-stat">
              <span class="stat-name">Favorite entries</span>
              <span class="stat-val" id="favorite-count">0</span>
            </div>
            <div class="writing-stat">
              <span class="stat-name">Most used tags</span>
              <span class="stat-val" id="top-tags">-</span>
            </div>
          </div>
        </div>
      </div>
      <button class="button-33 stats-back-btn" role="button" data-emoji="üè†">Back to Menu</button>
    </div>

    <!-- Wellness Chat Panel -->
    <div id="chat-panel" class="custom-panel chat-panel" style="display:none;">
      <div class="chat-header">
        <h2 style="margin:0">Serenity</h2>
      </div>
      <div class="chat-messages" id="chat-messages"></div>
      <div class="chat-input-row" id="chat-input-row">
        <textarea id="chat-input" placeholder="Type a message..." rows="1"></textarea>
      </div>
      <!-- New chat bubble button (initial trigger) -->
      <button id="chat-new-btn" class="chat-new-btn" title="New Chat">üí¨</button>
      <button class="button-33 chat-back-btn" role="button" data-emoji="üè†" style="margin-top:10px;">Back</button>
    </div>

    <!-- New Entry Panel -->
    <div id="new-entry-panel" class="custom-panel new-entry-panel" style="display: none;">
      <!-- Settings Button (upper right) -->
      <button class="settings-btn">‚öôÔ∏è</button>

      <!-- Circular button container -->
      <div class="new-entry-intro">
        <button class="paint-circle-btn">üñãÔ∏è</button>
      </div>

      <!-- Form contents (hidden until expanded) -->
      <div class="new-entry-contents">
        <div class="panel-title">
          <input type="text" class="entry-name" placeholder="Title" />
        </div>
        <div class="entry-meta">
          <span class="mood-badge"></span>
          <span class="date-stamp"></span>
        </div>
        <div class="panel-content">
          <!-- Rich Text Toolbar -->
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)"><b>B</b></button>
            <button type="button" class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)"><i>I</i></button>
            <button type="button" class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)"><u>U</u></button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Heading">H</button>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="blockquote" title="Quote">‚Äú</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">‚Ä¢</button>
            <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">1.</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="createLink" title="Insert Link">üîó</button>
            <button type="button" class="toolbar-btn insert-image-btn" title="Insert Image">üñºÔ∏è</button>
          </div>
          <!-- Rich Text Editor -->
          <div class="entry-content rich-editor" contenteditable="true" data-placeholder="Start writing..."></div>
          <input type="file" class="image-upload-input" accept="image/*" style="display:none;" />
        </div>
        <div class="editor-buttons">
          <button class="button-33 save-btn" role="button" data-emoji="üíæ">Save</button>
          <button class="button-33 back-btn" role="button" data-emoji="üè†">Back</button>
        </div>
      </div>
    </div>

    <!-- Mood Panel (intermediary before New Entry) -->
    <div id="mood-panel" class="custom-panel mood-panel" style="display:none;">
      <!-- Date / Greeting Header -->
      <div class="date-header" id="mood-date-header">
        <div class="date-bg"></div>
        <div class="greeting" id="greeting-text"></div>
        <div class="current-date" id="current-date"></div>
        <div class="date-row" id="date-strip"></div>
      </div>
      <h2 class="mood-panel-title">How are you feeling right now?</h2>
      <div style="display:flex;flex-direction:column;align-items:center;gap:20px;">
        <div class="mood-input-row">
          <span id="mood-prompt" class="mood-prompt"></span>
          <input id="mood-input" type="text" placeholder="..." class="mood-input" />
        </div>
        <button class="button-33 mood-next-btn" role="button" data-emoji="üìù">Start Writing</button>
        <button class="button-33 back-btn" role="button" data-emoji="üè†">Back</button>
      </div>
    </div>

    <!-- Template Picker Panel -->
    <div id="template-panel" class="custom-panel template-panel" style="display:none;">
      <h2>Choose a Template</h2>
      <div class="template-grid"></div>
      <button class="button-33 tpl-back-btn" role="button" data-emoji="üè†" style="position:absolute;">Back</button>
      <div id="template-info"></div>
    </div>

    <!-- Edit Entry Panel -->
    <div id="edit-entry-panel" class="custom-panel edit-entry-panel" style="display: none;">
      <!-- Settings Button (upper right) -->
      <button class="settings-btn">‚öôÔ∏è</button>
      <div class="new-entry-contents">
        <div class="panel-title">
          <input type="text" class="entry-name" placeholder="Title" />
        </div>
        <div class="entry-meta">
          <span class="mood-badge"></span>
          <span class="date-stamp"></span>
        </div>
        <div class="panel-content">
          <!-- Rich Text Toolbar -->
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)"><b>B</b></button>
            <button type="button" class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)"><i>I</i></button>
            <button type="button" class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)"><u>U</u></button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Heading">H</button>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="blockquote" title="Quote">‚Äú</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">‚Ä¢</button>
            <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">1.</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="createLink" title="Insert Link">üîó</button>
            <button type="button" class="toolbar-btn insert-image-btn" title="Insert Image">üñºÔ∏è</button>
          </div>
          <!-- Rich Text Editor -->
          <div class="entry-content rich-editor" contenteditable="true" data-placeholder="Start writing..."></div>
          <input type="file" class="image-upload-input" accept="image/*" style="display:none;" />
        </div>
        <div class="editor-buttons">
          <button class="button-33 save-btn" role="button" data-emoji="üíæ">Save Entry</button>
          <button class="button-33 back-btn" role="button" data-emoji="üè†">Back</button>
        </div>
      </div>
    </div>

    <!-- Shared Settings Panel (slides in from the right) -->
    <div id="settings-panel">
      <h3>Settings</h3>
      <button id="settings-close-btn" class="button-33" data-emoji="‚ùå" style="position:absolute;top:20px;right:20px;">Close</button>
      <label for="font-size-slider">Font Size:</label>
      <input type="range" id="font-size-slider" min="12" max="24" value="16" />
      <br />
      <!-- Custom Dropdown for Font Family -->
      <label>Font Family:</label>
      <div class="custom-dropdown" id="font-dropdown">
        <!-- Displayed "selected" item -->
        <div class="custom-dropdown-selected" id="font-dropdown-selected">Arial</div>
        <!-- The hidden list of options -->
        <ul class="custom-dropdown-list" id="font-dropdown-list">
          <li data-value="Arial, sans-serif">Arial</li>
          <li data-value="'Times New Roman', serif">Times New Roman</li>
          <li data-value="'Courier New', monospace">Courier New</li>
          <li data-value="'Georgia', serif">Georgia</li>
          <li data-value="'Verdana', sans-serif">Verdana</li>
        </ul>
      </div>

      <!-- Autosave Settings -->
      <div class="settings-separator"></div>
      <div class="autosave-section">
        <label><input type="checkbox" id="autosave-enabled" /> Enable Autosave (every 30s)</label>
      </div>

      <!-- Daily Mood Check-in Settings -->
      <div class="settings-separator"></div>
      <div class="mood-checkin-section">
        <label><input type="checkbox" id="mood-checkin-enabled" checked /> Daily Mood Check-in</label>
        <p class="settings-hint">Ask how you're feeling when you open the app each day</p>
      </div>
    </div>

    <!-- NEW: Export/Import Popup Panel (hidden by default) -->
    <div id="export-import-popup" class="export-import-popup" style="display: none;">
      <button id="export-btn" class="button-33" data-emoji="‚¨Ü">Export Entries</button>
      <button id="import-btn" class="button-33" data-emoji="‚¨á">Import Entries</button>
      <button id="export-import-close-btn" class="button-33" data-emoji="‚ùå">Close</button>
    </div>

    <!-- Custom Popup -->
    <div id="custom-popup" class="custom-popup">Entry saved!</div>

    <!-- Version Badge -->
    <div class="version-badge" style="color:#fff;font-size:0.9rem;opacity:0.8;">v0.2.0</div>

    <!-- JavaScript Modules -->
    <script type="module" src="js/core/main.js"></script>
    <script type="module" src="js/managers/chatManager.js"></script>
    <script type="module" src="js/managers/statsManager.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('SW registered:', registration.scope);
            })
            .catch(error => {
              console.log('SW registration failed:', error);
            });
        });
      }
    </script>
  </body>
</html>
