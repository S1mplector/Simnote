<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Simnote - A beautiful journaling app for capturing your thoughts, tracking your moods, and reflecting on your journey." data-i18n-content="meta.description" />
    <meta name="theme-color" content="#fcd8ff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Simnote" />
    <title>Simnote</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="img/icon-32.png" />
    <link rel="apple-touch-icon" href="img/icon-192.png" />
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css" />
    <!-- Google Font for main menu logo -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <!-- sql.js for SQLite support (local for offline support) -->
    <script src="/js/lib/sql-wasm.js"></script>
  </head>
  <body>
    <div class="utility-buttons" aria-label="Quick Controls" data-i18n-aria-label="aria.quickControls">
      <!-- Manual Button -->
      <button id="manual-btn" class="manual-btn" aria-label="Manual" data-i18n-aria-label="aria.manual">
        <span class="manual-book" aria-hidden="true">
          <span class="manual-book__pg-shadow"></span>
          <span class="manual-book__pg"></span>
          <span class="manual-book__pg manual-book__pg--2"></span>
          <span class="manual-book__pg manual-book__pg--3"></span>
          <span class="manual-book__pg manual-book__pg--4"></span>
          <span class="manual-book__pg manual-book__pg--5"></span>
        </span>
      </button>
      <!-- Theme Settings Button -->
      <button id="theme-settings-btn" class="theme-settings-btn" aria-label="Settings" data-i18n-aria-label="aria.settings">
        <span class="settings-lines" aria-hidden="true">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>

    <!-- Manual Popup (hidden by default) -->
    <div id="manual-popup" class="manual-popup">
      <h3 data-i18n="manual.title">Simnote Manual</h3>
      <p data-i18n="manual.intro">
        Simnote is your calm journaling space. Notes save as you type, so you can focus on writing.
      </p>
      <ul>
        <li data-i18n="manual.tip1">Start a new entry from the first drawer, or open past entries from the second drawer.</li>
        <li data-i18n="manual.tip2">Everything autosaves while you type. Press Esc to return to the main menu.</li>
        <li data-i18n="manual.tip3">Look at your mood data anytime from the third drawer.</li>
        <li data-i18n="manual.tip4">Customize themes, fonts, and preferences in Settings.</li>
      </ul>
      <p data-i18n="manual.refresher">Want a refresher? Run the quick tour anytime.</p>
      <button id="manual-tour-btn" class="nav-icon-btn" title="Start Tour" data-i18n-title="manual.startTour">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <path d="M8 5l11 7-11 7z"></path>
        </svg>
        <span class="icon-label" data-i18n="manual.startTour">Start Tour</span>
      </button>
      <button id="manual-close-btn" class="nav-icon-btn" title="Close" data-i18n-title="common.close">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span class="icon-label" data-i18n="common.close">Close</span>
      </button>
    </div>

    <!-- Theme Settings Popup (hidden by default) -->
    <div id="theme-settings-popup" class="theme-settings-popup">
      <div class="settings-section">
        <h4 style="margin:0 0 10px 0;" data-i18n="theme.title">Theme</h4>
        <nav class="theme-dock" id="theme-selector">
          <button class="theme-block" data-value="plain-dark" title="Dark" data-i18n-title="theme.dark" style="--theme-color: #888888;">
            <span class="theme-block__item"></span>
          </button>
          <button class="theme-block" data-value="dark-sakura" title="Sakura" data-i18n-title="theme.sakura" style="--theme-color: #fcd8ff;">
            <span class="theme-block__item"></span>
          </button>
          <button class="theme-block" data-value="dracula" title="Dracula" style="--theme-color: #bd93f9;">
            <span class="theme-block__item"></span>
          </button>
          <button class="theme-block" data-value="monokai" title="Monokai" style="--theme-color: #a6e22e;">
            <span class="theme-block__item"></span>
          </button>
          <button class="theme-block" data-value="lavender-breeze" title="Lavender" data-i18n-title="theme.lavender" style="--theme-color: #6E5BAF;">
            <span class="theme-block__item"></span>
          </button>
        </nav>
      </div>

      <!-- Data & Storage -->
      <div class="settings-section" style="margin-top:20px;">
        <h4 style="margin:0 0 8px 0;" data-i18n="storage.title">Data & Storage</h4>
        <div class="storage-info-compact">
          <span class="storage-stat-inline"><span id="storage-entries">0</span> <span data-i18n="storage.entries">entries</span></span>
          <span class="storage-divider">‚Ä¢</span>
          <span class="storage-stat-inline"><span id="storage-images">0</span> <span data-i18n="storage.images">images</span></span>
          <span class="storage-divider">‚Ä¢</span>
          <span class="storage-stat-inline"><span id="storage-size">0 KB</span></span>
        </div>
        
        <!-- File Storage Location -->
        <div class="storage-location-info" id="storage-location-section">
          <div class="storage-location-header">
            <svg class="storage-location-icon" viewBox="0 0 24 24" width="14" height="14">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="storage-location-label" data-i18n="storage.fileStorage">File Storage</span>
            <span class="storage-location-status" id="storage-location-status">‚óè</span>
          </div>
          <div class="storage-location-path" id="storage-location-path" title="Click to open folder" data-i18n-title="storage.clickToOpenFolder">
            ~/Documents/Simnote
          </div>
          <div class="storage-location-hint" data-i18n="storage.fileStorageHint">
            Your entries are saved as .simnote files for backup & portability
          </div>
        </div>
        
        <div class="storage-actions">
          <button id="export-data-btn" class="nav-icon-btn" title="Export" data-i18n-title="common.export">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span class="icon-label" data-i18n="common.export">Export</span>
          </button>
          <button id="import-data-btn" class="nav-icon-btn" title="Import" data-i18n-title="common.import">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span class="icon-label" data-i18n="common.import">Import</span>
          </button>
          <button id="clear-data-btn" class="nav-icon-btn danger" title="Clear All" data-i18n-title="common.clearAll">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            <span class="icon-label" data-i18n="common.clear">Clear</span>
          </button>
        </div>
        <input type="file" id="import-file-input" accept=".json" style="display:none;" />
      </div>

      <!-- Preferences -->
      <div class="settings-section" style="margin-top:20px;">
        <h4 style="margin:0 0 8px 0;" data-i18n="preferences.title">Preferences</h4>
        <div class="settings-option">
          <span class="settings-option-label" data-i18n="preferences.dailyMoodCheckin">Daily mood check-in</span>
          <label class="toggle-switch">
            <input type="checkbox" id="mood-checkin-toggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span class="settings-option-label" data-i18n="preferences.showPreviews">Show entry previews</span>
          <label class="toggle-switch">
            <input type="checkbox" id="preview-toggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span class="settings-option-label" data-i18n="preferences.compactList">Compact list view</span>
          <label class="toggle-switch">
            <input type="checkbox" id="compact-view-toggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span class="settings-option-label" data-i18n="preferences.language">Language</span>
          <nav class="theme-dock" id="language-selector">
            <button class="theme-block" data-value="en" title="English" data-i18n-title="language.english">
              <span class="theme-block__flag">üá¨üáß</span>
            </button>
            <button class="theme-block" data-value="tr" title="T√ºrk√ße" data-i18n-title="language.turkish">
              <span class="theme-block__flag">üáπüá∑</span>
            </button>
          </nav>
        </div>
      </div>

      <!-- Close button -->
      <button id="theme-settings-close-btn" class="nav-icon-btn" title="Close" data-i18n-title="common.close" style="position:absolute;bottom:20px;right:20px;">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span class="icon-label" data-i18n="common.close">Close</span>
      </button>
    </div>

    <!-- Background Canvas -->
    <canvas id="bg-canvas"></canvas>

    <!-- Main Panel -->
    <div id="main-panel">
      <div class="blur-overlay"></div>
      <div class="center-container">
        <div class="logo-and-heart">
          <div class="simnote-logo">
            <span class="logo-text">Simnote</span>
            <span class="logo-version">v0.1.0</span>
          </div>
        </div>
        <!-- 3D Drawer Navigation -->
        <div class="drawer-nav" id="drawer-nav">
          <div class="chest">
            <!-- Quote card sitting on top of the drawer -->
            <div class="quote-card-wrap">
              <div class="quote-card" id="quote-card" role="button" tabindex="0" aria-label="Open quotes" data-i18n-aria-label="quote.open" aria-expanded="false">
                <div class="quote-card__lines">
                  <span class="quote-card__line"></span>
                  <span class="quote-card__line"></span>
                  <span class="quote-card__line"></span>
                </div>
              </div>
              <span class="quote-card-label" data-i18n="quote.label">Quotes</span>
            </div>
            <div class="chest__panel chest__panel--back"></div>
            <div class="chest__panel chest__panel--top"></div>
            <div class="chest__panel chest__panel--bottom"></div>
            <div class="chest__panel chest__panel--right"></div>
            <div class="chest__panel chest__panel--front">
              <div class="chest__panel chest__panel--front-frame"></div>
            </div>
            <div class="chest__panel chest__panel--left"></div>
            
            <!-- Drawer 1: Journal -->
            <div class="chest__drawer drawer" data-position="1" data-action="journal">
              <button class="drawer-trigger" id="new-entry-btn" title="Journal" data-i18n-title="drawer.journal"></button>
              <span class="drawer-label" data-i18n="drawer.journal">Journal</span>
              <div class="drawer__structure">
                <div class="drawer__panel drawer__panel--back">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 20h9"></path>
                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                  </svg>
                </div>
                <div class="drawer__panel drawer__panel--bottom"></div>
                <div class="drawer__panel drawer__panel--right"></div>
                <div class="drawer__panel drawer__panel--left"></div>
                <div class="drawer__panel drawer__panel--front"></div>
              </div>
            </div>
            
            <!-- Drawer 2: Entries -->
            <div class="chest__drawer drawer" data-position="2" data-action="entries">
              <button class="drawer-trigger" id="load-entry-btn" title="Entries" data-i18n-title="drawer.entries"></button>
              <span class="drawer-label" data-i18n="drawer.entries">Entries</span>
              <div class="drawer__structure">
                <div class="drawer__panel drawer__panel--back">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M2 3h7a4 4 0 0 1 4 4v14a3 3 0 0 0-4-3H2z"></path>
                    <path d="M22 3h-7a4 4 0 0 0-4 4v14a3 3 0 0 1 4-3h7z"></path>
                  </svg>
                </div>
                <div class="drawer__panel drawer__panel--bottom"></div>
                <div class="drawer__panel drawer__panel--right"></div>
                <div class="drawer__panel drawer__panel--left"></div>
                <div class="drawer__panel drawer__panel--front"></div>
              </div>
            </div>
            
            <!-- Drawer 3: Moods -->
            <div class="chest__drawer drawer" data-position="3" data-action="moods">
              <button class="drawer-trigger" id="stats-btn" title="Moods" data-i18n-title="drawer.moods"></button>
              <span class="drawer-label" data-i18n="drawer.moods">Moods</span>
              <div class="drawer__structure">
                <div class="drawer__panel drawer__panel--back">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                  </svg>
                </div>
                <div class="drawer__panel drawer__panel--bottom"></div>
                <div class="drawer__panel drawer__panel--right"></div>
                <div class="drawer__panel drawer__panel--left"></div>
                <div class="drawer__panel drawer__panel--front"></div>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>

    <div class="quote-overlay" id="quote-overlay" aria-hidden="true"></div>

    <!-- Quote Panel Container -->
    <div class="quote-panel-container" id="quote-panel-container">
      <!-- Arrow navigation outside card -->
      <button class="quote-nav-arrow quote-nav-arrow--prev" id="quote-panel-prev" type="button" title="Previous quote (‚Üê)" data-i18n-title="quote.previousTitle" aria-label="Previous quote" data-i18n-aria-label="quote.previous">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      
      <div class="quote-panel" id="quote-panel">
        <button class="quote-panel__fav-btn" id="quote-panel-favorite" type="button" title="Favorite quote" data-i18n-title="quote.favorite" aria-pressed="false">ü§ç</button>
        <div class="quote-panel__content">
          <div class="quote-panel__quote" id="quote-panel-text" data-i18n="quote.loading">Loading quote...</div>
          <div class="quote-panel__author" id="quote-panel-author"></div>
        </div>
        <div class="quote-panel__actions">
          <button class="quote-panel__btn quote-panel__btn--accent" id="quote-panel-journal" type="button" title="Journal about this quote" data-i18n-title="quote.journalTitle" data-i18n="quote.journal">Journal</button>
        </div>
        <button class="quote-panel__btn quote-panel__btn--close" id="quote-panel-close" type="button" title="Close" data-i18n-title="common.close" data-i18n="quote.putDown">Put down</button>
        <div class="quote-panel__status" id="quote-panel-status" aria-live="polite"></div>
      </div>
      
      <button class="quote-nav-arrow quote-nav-arrow--next" id="quote-panel-next" type="button" title="Next quote (‚Üí)" data-i18n-title="quote.nextTitle" aria-label="Next quote" data-i18n-aria-label="quote.next">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <!-- Journal Panel -->
    <div id="journal-panel" style="display: none;">
      <div class="entries-pane">
        <div class="entries-header">
          <h2 style="margin:0" data-i18n="journal.title">Entries</h2>
          <!-- Search (magnifying glass) toggle & input -->
          <button id="search-toggle-btn" class="search-toggle-btn" title="Search" data-i18n-title="common.search">üîç</button>
          <input id="entry-search" class="entry-search collapsed" type="text" placeholder="Search..." data-i18n-placeholder="journal.searchPlaceholder" />
          <!-- Sort dropdown -->
          <div class="custom-dropdown sort-dropdown" id="sort-dropdown">
            <div class="custom-dropdown-selected" id="sort-selected">Newest</div>
            <ul class="custom-dropdown-list" id="sort-list">
              <li data-value="newest" data-i18n="journal.sortNewest">Newest First</li>
              <li data-value="oldest" data-i18n="journal.sortOldest">Oldest First</li>
              <li data-value="az" data-i18n="journal.sortAz">A ‚Üí Z</li>
              <li data-value="mood" data-i18n="journal.sortMood">By Mood</li>
            </ul>
          </div>
          <button id="date-picker-btn" class="calendar-btn" title="Filter by date" data-i18n-title="journal.filterByDate">üìÖ</button>
          <div id="custom-calendar" class="custom-calendar" style="display:none;"></div>
        </div>
        <div class="entry-list"></div>
        <button class="nav-icon-btn back-to-menu" title="Back to Menu" data-i18n-title="nav.backToMenu">
          <svg class="nav-icon-svg" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span class="icon-label" data-i18n="common.menu">Menu</span>
        </button>
      </div>
    </div>

    <!-- Stats Preloader -->
    <div id="stats-preloader" class="stats-preloader">
      <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
      <div class="stats-preloader-text">Analyzing your moods...</div>
    </div>

    <!-- Mood Tracking Panel -->
    <div id="stats-panel" class="custom-panel stats-panel" style="display:none;">
      <div class="stats-header">
        <h2 data-i18n="stats.title">Mood Insights</h2>
        <div class="stats-period-selector">
          <button class="period-btn active" data-period="week">7D</button>
          <button class="period-btn" data-period="month">30D</button>
          <button class="period-btn" data-period="quarter">90D</button>
        </div>
      </div>
      <!-- Loading Overlay -->
      <div class="stats-loader hidden" id="stats-loader">
        <div class="loader-content">
          <div class="loader-spinner"></div>
          <div class="loader-text">Analyzing your moods...</div>
        </div>
      </div>
      
      <div class="stats-content">
        <!-- Mood Overview Card -->
        <div class="stats-section mood-overview-section">
          <div class="mood-overview-card">
            <div class="mood-score-ring" id="mood-score-ring">
              <svg viewBox="0 0 120 120">
                <circle class="ring-bg" cx="60" cy="60" r="52" />
                <circle class="ring-progress" cx="60" cy="60" r="52" id="mood-ring-progress" />
              </svg>
              <div class="mood-score-content">
                <span class="mood-score-emoji" id="mood-overview-emoji">üòä</span>
                <span class="mood-score-label" id="mood-overview-label">Good</span>
              </div>
            </div>
            <div class="mood-mini-graph" id="mood-mini-graph">
              <svg class="mini-graph-svg" viewBox="0 0 200 60" preserveAspectRatio="none">
                <defs>
                  <linearGradient id="miniGraphGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:var(--accent);stop-opacity:0.3" />
                    <stop offset="100%" style="stop-color:var(--accent);stop-opacity:0" />
                  </linearGradient>
                </defs>
                <path class="mini-graph-area" id="mini-graph-area" fill="url(#miniGraphGradient)" />
                <path class="mini-graph-line" id="mini-graph-line" />
              </svg>
              <div class="mini-graph-labels">
                <span class="mini-graph-high" id="mini-graph-high">--</span>
                <span class="mini-graph-low" id="mini-graph-low">--</span>
              </div>
            </div>
            <div class="mood-overview-stats">
              <div class="mood-overview-stat">
                <span class="stat-emoji">üòä</span>
                <span class="stat-percent" id="positive-percent">0%</span>
                <span class="stat-sublabel">Positive</span>
              </div>
              <div class="mood-overview-stat">
                <span class="stat-emoji">üòê</span>
                <span class="stat-percent" id="neutral-percent">0%</span>
                <span class="stat-sublabel">Neutral</span>
              </div>
              <div class="mood-overview-stat">
                <span class="stat-emoji">üòî</span>
                <span class="stat-percent" id="negative-percent">0%</span>
                <span class="stat-sublabel">Negative</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Insights Cards -->
        <div class="stats-section insights-section">
          <h3>Insights</h3>
          <div class="insights-grid" id="insights-grid">
            <!-- Dynamically populated -->
          </div>
        </div>

        <!-- Time of Day Analysis -->
        <div class="stats-section time-analysis-section">
          <h3>When You Feel Best</h3>
          <div class="time-bars" id="time-bars">
            <div class="time-bar" data-period="morning">
              <span class="time-emoji">üåÖ</span>
              <div class="time-bar-track">
                <div class="time-bar-fill" id="morning-bar"></div>
              </div>
              <span class="time-label">Morning</span>
              <span class="time-score" id="morning-score">--</span>
            </div>
            <div class="time-bar" data-period="afternoon">
              <span class="time-emoji">‚òÄÔ∏è</span>
              <div class="time-bar-track">
                <div class="time-bar-fill" id="afternoon-bar"></div>
              </div>
              <span class="time-label">Afternoon</span>
              <span class="time-score" id="afternoon-score">--</span>
            </div>
            <div class="time-bar" data-period="evening">
              <span class="time-emoji">üåÜ</span>
              <div class="time-bar-track">
                <div class="time-bar-fill" id="evening-bar"></div>
              </div>
              <span class="time-label">Evening</span>
              <span class="time-score" id="evening-score">--</span>
            </div>
            <div class="time-bar" data-period="night">
              <span class="time-emoji">üåô</span>
              <div class="time-bar-track">
                <div class="time-bar-fill" id="night-bar"></div>
              </div>
              <span class="time-label">Night</span>
              <span class="time-score" id="night-score">--</span>
            </div>
          </div>
        </div>

        <!-- Day of Week Pattern -->
        <div class="stats-section dow-section">
          <h3>Weekly Pattern</h3>
          <div class="dow-chart" id="dow-chart">
            <div class="dow-bar" data-day="0"><span class="dow-label">Sun</span><div class="dow-fill"></div><span class="dow-score"></span></div>
            <div class="dow-bar" data-day="1"><span class="dow-label">Mon</span><div class="dow-fill"></div><span class="dow-score"></span></div>
            <div class="dow-bar" data-day="2"><span class="dow-label">Tue</span><div class="dow-fill"></div><span class="dow-score"></span></div>
            <div class="dow-bar" data-day="3"><span class="dow-label">Wed</span><div class="dow-fill"></div><span class="dow-score"></span></div>
            <div class="dow-bar" data-day="4"><span class="dow-label">Thu</span><div class="dow-fill"></div><span class="dow-score"></span></div>
            <div class="dow-bar" data-day="5"><span class="dow-label">Fri</span><div class="dow-fill"></div><span class="dow-score"></span></div>
            <div class="dow-bar" data-day="6"><span class="dow-label">Sat</span><div class="dow-fill"></div><span class="dow-score"></span></div>
          </div>
          <div class="dow-summary" id="dow-summary"></div>
        </div>

        <!-- Mood Drivers (Correlations) -->
        <div class="stats-section drivers-section">
          <h3>What Affects Your Mood</h3>
          <div class="drivers-grid">
            <div class="driver-column positive-drivers">
              <div class="driver-header">
                <span class="driver-icon">üí™</span>
                <span class="driver-title">Mood Boosters</span>
              </div>
              <div class="driver-list" id="positive-drivers-list">
                <p class="no-data">Keep journaling to discover patterns</p>
              </div>
            </div>
            <div class="driver-column negative-drivers">
              <div class="driver-header">
                <span class="driver-icon">‚ö†Ô∏è</span>
                <span class="driver-title">Stress Triggers</span>
              </div>
              <div class="driver-list" id="negative-drivers-list">
                <p class="no-data">Keep journaling to discover patterns</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Streak Section -->
        <div class="stats-section streak-section">
          <div class="stat-card streak-card">
            <div class="stat-icon">üî•</div>
            <div class="stat-value" id="current-streak">0</div>
            <div class="stat-label" data-i18n="stats.dayStreak">Day Streak</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-value" id="longest-streak">0</div>
            <div class="stat-label" data-i18n="stats.bestStreak">Best Streak</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìù</div>
            <div class="stat-value" id="total-entries">0</div>
            <div class="stat-label" data-i18n="stats.totalEntries">Total Entries</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìñ</div>
            <div class="stat-value" id="total-words">0</div>
            <div class="stat-label" data-i18n="stats.wordsWritten">Words Written</div>
          </div>
        </div>

        <!-- Calendar Heatmap -->
        <div class="stats-section">
          <h3 data-i18n="stats.activityCalendar">Activity Calendar</h3>
          <div class="heatmap-container">
            <div class="heatmap-months" id="heatmap-months"></div>
            <div class="heatmap-grid" id="heatmap-grid"></div>
            <div class="heatmap-legend">
              <span data-i18n="stats.less">Less</span>
              <div class="legend-cell" data-level="0"></div>
              <div class="legend-cell" data-level="1"></div>
              <div class="legend-cell" data-level="2"></div>
              <div class="legend-cell" data-level="3"></div>
              <div class="legend-cell" data-level="4"></div>
              <span data-i18n="stats.more">More</span>
            </div>
          </div>
        </div>

        <!-- Writing Stats -->
        <div class="stats-section">
          <h3 data-i18n="stats.writingStatistics">Writing Statistics</h3>
          <div class="writing-stats">
            <div class="writing-stat">
              <span class="stat-name" data-i18n="stats.avgWords">Average words per entry</span>
              <span class="stat-val" id="avg-words">0</span>
            </div>
            <div class="writing-stat">
              <span class="stat-name" data-i18n="stats.favoriteEntries">Favorite entries</span>
              <span class="stat-val" id="favorite-count">0</span>
            </div>
            <div class="writing-stat">
              <span class="stat-name" data-i18n="stats.topTags">Most used tags</span>
              <span class="stat-val" id="top-tags">-</span>
            </div>
          </div>
        </div>

        <!-- Mood Stability Section -->
        <div class="stats-section volatility-section">
          <h3>Mood Stability</h3>
          <div class="volatility-meter">
            <div class="volatility-gauge">
              <div class="volatility-track">
                <div class="volatility-fill" id="volatility-fill"></div>
              </div>
              <div class="volatility-markers">
                <span>Stable</span>
                <span>Variable</span>
                <span>Volatile</span>
              </div>
            </div>
            <div class="volatility-info">
              <span class="volatility-score" id="volatility-score">--</span>
              <span class="volatility-label" id="volatility-label">Calculating...</span>
            </div>
          </div>
          <div class="stability-causes" id="stability-causes">
            <!-- Dynamically populated by MoodStabilityEngine -->
          </div>
        </div>
      </div>
      <button class="nav-icon-btn stats-back-btn" title="Back to Menu" data-i18n-title="nav.backToMenu">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span class="icon-label" data-i18n="common.menu">Menu</span>
      </button>
    </div>

    <!-- Wellness Chat Panel -->
    <div id="chat-panel" class="custom-panel chat-panel" style="display:none;">
      <div class="chat-header">
        <h2 style="margin:0">Serenity</h2>
      </div>
      <div class="chat-messages" id="chat-messages"></div>
      <div class="chat-input-row" id="chat-input-row">
        <textarea id="chat-input" placeholder="Type a message..." data-i18n-placeholder="chat.placeholder" rows="1"></textarea>
      </div>
      <!-- New chat bubble button (initial trigger) -->
      <button id="chat-new-btn" class="chat-new-btn" title="New Chat" data-i18n-title="chat.newChat">üí¨</button>
      <button class="nav-icon-btn chat-back-btn" title="Back" data-i18n-title="common.back" style="margin-top:10px;">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span class="icon-label" data-i18n="common.menu">Menu</span>
      </button>
    </div>

    <!-- New Entry Panel -->
    <div id="new-entry-panel" class="custom-panel new-entry-panel" style="display: none;">
      <div class="panel-utility">
        <!-- Settings Button (upper right) -->
        <button class="settings-btn" aria-label="Editor Settings" data-i18n-aria-label="aria.editorSettings">
          <span class="settings-lines" aria-hidden="true">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
      </div>

      <!-- Circular button container -->
      <div class="new-entry-intro">
        <button class="paint-circle-btn">üñãÔ∏è</button>
      </div>

      <!-- Form contents (hidden until expanded) -->
      <div class="new-entry-contents">
        <div class="panel-title">
          <input type="text" class="entry-name" placeholder="Title" data-i18n-placeholder="entry.titlePlaceholder" />
        </div>
        <div class="entry-meta">
          <span class="mood-badge"></span>
          <span class="date-stamp"></span>
        </div>
        <div class="panel-content">
          <!-- Rich Text Toolbar -->
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)" data-i18n-title="editor.bold"><b>B</b></button>
            <button type="button" class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)" data-i18n-title="editor.italic"><i>I</i></button>
            <button type="button" class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)" data-i18n-title="editor.underline"><u>U</u></button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Heading" data-i18n-title="editor.heading">H</button>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="blockquote" title="Quote" data-i18n-title="editor.quote">‚Äú</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List" data-i18n-title="editor.bullets">‚Ä¢</button>
            <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numbered List" data-i18n-title="editor.numbered">1.</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="createLink" title="Insert Link" data-i18n-title="editor.insertLink">üîó</button>
            <button type="button" class="toolbar-btn insert-image-btn" title="Insert Image" data-i18n-title="editor.insertImage">üñºÔ∏è</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn audio-recorder-btn" title="Record Audio" data-i18n-title="editor.recordAudio">
              <div class="tape-recorder-3d">
                <div class="tape-base">
                  <div class="tape-mini-reel left"></div>
                  <div class="tape-mini-reel right"></div>
                  <div class="tape-mini-window"></div>
                </div>
              </div>
            </button>
          </div>
          <!-- Rich Text Editor -->
          <div class="entry-content rich-editor" contenteditable="true" data-placeholder="Start writing..." data-i18n-placeholder="entry.contentPlaceholder"></div>
          <input type="file" class="image-upload-input" accept="image/*" style="display:none;" />
        </div>
        <div class="editor-buttons">
          <button class="nav-icon-btn save-btn" title="Save" data-i18n-title="common.save">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span class="icon-label" data-i18n="common.save">Save</span>
          </button>
          <button class="nav-icon-btn back-btn" title="Back" data-i18n-title="common.back">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="icon-label" data-i18n="common.menu">Menu</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Mood Panel (intermediary before New Entry) -->
    <div id="mood-panel" class="custom-panel mood-panel" style="display:none;">
      <!-- Date / Greeting Header -->
      <div class="date-header" id="mood-date-header">
        <div class="date-bg"></div>
        <div class="greeting" id="greeting-text"></div>
        <div class="current-date" id="current-date"></div>
        <div class="date-row" id="date-strip"></div>
      </div>
      <h2 class="mood-panel-title" data-i18n="mood.heading">How are you feeling right now?</h2>
      <div style="display:flex;flex-direction:column;align-items:center;gap:20px;">
        <div class="mood-input-row">
          <span id="mood-prompt" class="mood-prompt"></span>
          <input id="mood-input" type="text" placeholder="..." class="mood-input" />
        </div>
        <button class="nav-icon-btn mood-next-btn" title="Start Writing" data-i18n-title="mood.startWriting">
          <svg class="nav-icon-svg" viewBox="0 0 24 24">
            <path d="M12 20h9"></path>
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
          </svg>
          <span class="icon-label" data-i18n="common.write">Write</span>
        </button>
        <button class="nav-icon-btn back-btn" title="Back" data-i18n-title="common.back">
          <svg class="nav-icon-svg" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span class="icon-label" data-i18n="common.menu">Menu</span>
        </button>
      </div>
    </div>

    <!-- Mood Attributes Panel (after mood input, select what's affecting your mood) -->
    <div id="mood-attributes-panel" class="custom-panel" style="display:none;">
      <h2 class="attributes-title" data-i18n="attributes.title">What's making you feel this way?</h2>
      <p class="attributes-subtitle" data-i18n="attributes.subtitle">Tap to select ‚Ä¢ Hold to edit or reorder</p>
      <div class="attributes-grid"></div>
      <div class="attributes-nav">
        <button class="nav-icon-btn attributes-back-btn" title="Back" data-i18n-title="common.back">
          <svg class="nav-icon-svg" viewBox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          <span class="icon-label" data-i18n="common.back">Back</span>
        </button>
        <button class="nav-icon-btn attributes-next-btn" title="Continue" data-i18n-title="common.continue">
          <svg class="nav-icon-svg" viewBox="0 0 24 24">
            <path d="M12 20h9"></path>
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
          </svg>
          <span class="icon-label" data-i18n="common.write">Write</span>
        </button>
      </div>
    </div>

    <!-- Template Picker Panel -->
    <div id="template-panel" class="custom-panel template-panel" style="display:none;">
      <h2 data-i18n="templates.title">Choose a Template</h2>
      <div class="template-grid"></div>
      <button class="nav-icon-btn tpl-back-btn" title="Back" data-i18n-title="common.back" style="position:absolute;">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span class="icon-label" data-i18n="common.menu">Menu</span>
      </button>
      <div id="template-info"></div>
    </div>

    <!-- Edit Entry Panel -->
    <div id="edit-entry-panel" class="custom-panel edit-entry-panel" style="display: none;">
      <div class="panel-utility">
        <!-- Settings Button (upper right) -->
        <button class="settings-btn" aria-label="Editor Settings" data-i18n-aria-label="aria.editorSettings">
          <span class="settings-lines" aria-hidden="true">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
      </div>
      <div class="new-entry-contents">
        <div class="panel-title">
          <input type="text" class="entry-name" placeholder="Title" data-i18n-placeholder="entry.titlePlaceholder" />
        </div>
        <div class="entry-meta">
          <span class="mood-badge"></span>
          <span class="date-stamp"></span>
        </div>
        <div class="panel-content">
          <!-- Rich Text Toolbar -->
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)" data-i18n-title="editor.bold"><b>B</b></button>
            <button type="button" class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)" data-i18n-title="editor.italic"><i>I</i></button>
            <button type="button" class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)" data-i18n-title="editor.underline"><u>U</u></button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Heading" data-i18n-title="editor.heading">H</button>
            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="blockquote" title="Quote" data-i18n-title="editor.quote">‚Äú</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List" data-i18n-title="editor.bullets">‚Ä¢</button>
            <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numbered List" data-i18n-title="editor.numbered">1.</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn" data-command="createLink" title="Insert Link" data-i18n-title="editor.insertLink">üîó</button>
            <button type="button" class="toolbar-btn insert-image-btn" title="Insert Image" data-i18n-title="editor.insertImage">üñºÔ∏è</button>
            <span class="toolbar-divider"></span>
            <button type="button" class="toolbar-btn audio-recorder-btn" title="Record Audio" data-i18n-title="editor.recordAudio">
              <div class="tape-recorder-3d">
                <div class="tape-base">
                  <div class="tape-mini-reel left"></div>
                  <div class="tape-mini-reel right"></div>
                  <div class="tape-mini-window"></div>
                </div>
              </div>
            </button>
          </div>
          <!-- Rich Text Editor -->
          <div class="entry-content rich-editor" contenteditable="true" data-placeholder="Start writing..." data-i18n-placeholder="entry.contentPlaceholder"></div>
          <input type="file" class="image-upload-input" accept="image/*" style="display:none;" />
        </div>
        <div class="editor-buttons">
          <button class="nav-icon-btn save-btn" title="Save" data-i18n-title="common.save">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span class="icon-label" data-i18n="common.save">Save</span>
          </button>
          <button class="nav-icon-btn back-btn" title="Back" data-i18n-title="common.back">
            <svg class="nav-icon-svg" viewBox="0 0 24 24">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="icon-label" data-i18n="common.menu">Menu</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Shared Settings Panel (slides in from the right) -->
    <div id="settings-panel">
      <h3 data-i18n="settings.title">Settings</h3>
      <button id="settings-close-btn" class="nav-icon-btn" title="Close" data-i18n-title="common.close" style="position:absolute;bottom:20px;right:20px;">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span class="icon-label" data-i18n="common.close">Close</span>
      </button>
      <div class="settings-group">
        <label for="font-size-slider" data-i18n="settings.fontSize">Font Size</label>
        <div class="settings-range">
          <input type="range" id="font-size-slider" min="12" max="24" value="16" />
          <span class="range-value" id="font-size-value">16px</span>
        </div>
      </div>

      <div class="settings-group">
        <label for="line-height-slider" data-i18n="settings.lineHeight">Line Height</label>
        <div class="settings-range">
          <input type="range" id="line-height-slider" min="1.2" max="2.2" step="0.05" value="1.6" />
          <span class="range-value" id="line-height-value">1.6</span>
        </div>
      </div>

      <div class="settings-group">
        <label data-i18n="settings.fontFamily">Font Family</label>
        <div class="custom-dropdown" id="font-dropdown">
          <div class="custom-dropdown-selected" id="font-dropdown-selected">Arial</div>
          <ul class="custom-dropdown-list" id="font-dropdown-list">
            <li data-value="Arial, sans-serif">Arial</li>
            <li data-value="'Times New Roman', serif">Times New Roman</li>
            <li data-value="'Courier New', monospace">Courier New</li>
            <li data-value="'Georgia', serif">Georgia</li>
            <li data-value="'Verdana', sans-serif">Verdana</li>
          </ul>
        </div>
      </div>

      <div class="settings-group">
        <label data-i18n="settings.textWidth">Text Width</label>
        <div class="custom-dropdown" id="entry-width-dropdown">
          <div class="custom-dropdown-selected" id="entry-width-selected">Comfortable</div>
          <ul class="custom-dropdown-list" id="entry-width-list">
            <li data-value="720px" data-i18n="settings.widthNarrow">Narrow</li>
            <li data-value="1000px" data-i18n="settings.widthComfortable">Comfortable</li>
            <li data-value="100%" data-i18n="settings.widthFull">Full</li>
          </ul>
        </div>
      </div>

      <div class="settings-option">
        <span class="settings-option-label" data-i18n="settings.showToolbar">Show formatting toolbar</span>
        <label class="toggle-switch">
          <input type="checkbox" id="toolbar-toggle" checked />
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="settings-option">
        <span class="settings-option-label" data-i18n="settings.showWordCount">Show word count</span>
        <label class="toggle-switch">
          <input type="checkbox" id="word-count-toggle" />
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="settings-option">
        <span class="settings-option-label" data-i18n="settings.spellcheck">Spellcheck</span>
        <label class="toggle-switch">
          <input type="checkbox" id="spellcheck-toggle" checked />
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="settings-option">
        <span class="settings-option-label" data-i18n="settings.sfx">Sound Effects</span>
        <label class="toggle-switch">
          <input type="checkbox" id="sfx-toggle" checked />
          <span class="toggle-slider"></span>
        </label>
      </div>

    </div>

    <!-- NEW: Export/Import Popup Panel (hidden by default) -->
    <div id="export-import-popup" class="export-import-popup" style="display: none;">
      <button id="export-btn" class="settings-icon-btn" title="Export" data-i18n-title="common.export">
        <svg class="settings-icon-svg" viewBox="0 0 24 24">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <span class="settings-icon-label" data-i18n="common.export">Export</span>
      </button>
      <button id="import-btn" class="settings-icon-btn" title="Import" data-i18n-title="common.import">
        <svg class="settings-icon-svg" viewBox="0 0 24 24">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        <span class="settings-icon-label" data-i18n="common.import">Import</span>
      </button>
      <button id="export-import-close-btn" class="nav-icon-btn" title="Close" data-i18n-title="common.close">
        <svg class="nav-icon-svg" viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span class="icon-label" data-i18n="common.close">Close</span>
      </button>
    </div>

    <!-- Custom Popup -->
    <div id="custom-popup" class="custom-popup" data-i18n="entry.saved">Entry saved!</div>

    <!-- JavaScript Modules -->
    <script type="module" src="js/core/main.js"></script>
    <script type="module" src="js/managers/quoteCardManager.js"></script>
    <script type="module" src="js/managers/chatManager.js"></script>
    <script type="module" src="js/managers/statsManager.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('SW registered:', registration.scope);
            })
            .catch(error => {
              console.log('SW registration failed:', error);
            });
        });
      }
    </script>
  </body>
</html>
